<!--
    ==========================================================================
    Alerts Page
    --------------------------------------------------------------------------
    - Display live alerts as they are received
    - Does not contain historical data
    - Alerts may come from a service or a plugin
    ==========================================================================
-->

{% extends "base.html" %}
{% block content %}

<!--
    ==========================================================================
    Java Script
    --------------------------------------------------------------------------
    - Auto-refresh toggle
    - If checked, the page will auto-refresh every 10 seconds
    ==========================================================================
-->
<script>
let autoRefreshInterval = null;

document.addEventListener('DOMContentLoaded', function() {
    const toggle = document.getElementById('autoRefreshToggle');
    // Optional: Remember toggle state across reloads
    if (localStorage.getItem('autoRefresh') === 'on') {
        toggle.checked = true;
        startAutoRefresh();
    }
    toggle.addEventListener('change', function() {
        if (toggle.checked) {
            localStorage.setItem('autoRefresh', 'on');
            startAutoRefresh();
        } else {
            localStorage.setItem('autoRefresh', 'off');
            stopAutoRefresh();
        }
    });
});

function startAutoRefresh() {
    stopAutoRefresh();
    autoRefreshInterval = setInterval(function() {
        location.reload();
    }, 10000); // 10 seconds
}

function stopAutoRefresh() {
    if (autoRefreshInterval) {
        clearInterval(autoRefreshInterval);
        autoRefreshInterval = null;
    }
}
</script>

<!--
    ==========================================================================
    CSS Styles
    --------------------------------------------------------------------------
    Main
    - Override the default W3.CSS styles to make the page full width
    - This is necessary to ensure the table fits the screen width

    Table
    - Format the table to look like a log viewer
    ==========================================================================
-->
<style>
main {
    max-width: 90vw !important;
    width: 90vw !important;
    margin-left: 10 !important;
    margin-right: 10 !important;
    padding-left: 10 !important;
    padding-right: 10 !important;
}
</style>

<style>
.w3-table th, .w3-table td {
    font-family: "Consolas", "Menlo", "Monaco", monospace;
    font-size: 15px;
    vertical-align: top;
    padding: 6px 8px;
}
.w3-table td {
    background: #222831;
    color: #f1f1f1;
    border-bottom: 1px solid #444;
}
.w3-table th {
    background: #393e46;
    color: #00adb5;
    border-bottom: 2px solid #00adb5;
}
</style>

<!--
    ==========================================================================
    Page Title and Refresh Button
    --------------------------------------------------------------------------
    - Title: "Live Alerts"
    - Refresh button: reloads the page to get the latest alerts
    - This is a separate section to align the refresh button with the title
    ==========================================================================
-->
<div class="w3-container w3-padding-16" style="padding-left:0; padding-right:0;">
    <div style="display: flex; align-items: center; justify-content: space-between;">
        <!-- Title -->
        <h1 style="margin: 0; text-align: left;">Live Alerts</h1>
        
        <!-- Refresh Button -->
        <div style="display: flex; align-items: center; gap: 12px;">
            <i class="fa fa-refresh"
            style="color:green; font-size:24px; cursor:pointer; text-align: right;"
            onclick="location.reload();"
            title="Refresh"></i>
            <label style="display: flex; align-items: center; font-size: 15px; margin-left: 12px;">
                <input type="checkbox" id="autoRefreshToggle" style="margin-right: 6px;">
                Auto-refresh
            </label>
        </div>    
    </div>
</div>

<!--
    ==========================================================================
    Table of alert entries
    --------------------------------------------------------------------------
    - Date and Time
    - Source (service or plugins name)
    - Alert message
    ==========================================================================
-->
<div class="w3-container w3-padding-16" style="width:90vw; max-width:1600px; margin:0 auto; overflow-x:auto;">
    <table class="w3-table w3-striped" style="table-layout: auto; width: 100%;">
        <thead>
            <tr>
                <th style="white-space:nowrap;">Time</th>
                <th style="white-space:nowrap;">Source</th>
                <th style="white-space:nowrap;">Type</th>
                <th>Message</th>
            </tr>
        </thead>
        <tbody>
        {% for alert in alerts %}
            <tr>
                <td style="white-space:nowrap;">{{ alert[0] }}</td>
                <td style="white-space:nowrap;">{{ alert[1] }}</td>
                <td style="white-space:nowrap;">{{ alert[2] }}</td>
                <td style="white-space:normal; overflow-wrap:break-word; word-break:break-all;">{{ alert[3] }}</td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
</div>

{% endblock %}