<!--
    ==========================================================================
    Configuration Page
    --------------------------------------------------------------------------
    - Configure the application as a whole
    - Cards for each category of configuration
    --------------------------------------------------------------------------
    Categories:
    - Azure
    - Authentication
    - Teams
    - SQL
    - Web
    ==========================================================================
-->

{% extends "base.html" %}


{% block content %}

<!--
    ==========================================================================
    Scripts
    --------------------------------------------------------------------------
    saveconfig.js:
        - Collects configuration data from the form
        - Sends the data to the web interface
    ==========================================================================
-->
<script src="{{ url_for('static', filename='js/saveconfig.js') }}"></script>


<h1>Configuration</h1>
</br>

<!--
    ==========================================================================
    Azure
    --------------------------------------------------------------------------
    Tenant ID - The ID of the Azure tenant
    ==========================================================================
-->
<div class="w3-responsive w3-card-4">
    <!-- General Azure  -->
    <header class="w3-container w3-light-grey">
        <h3>Azure</h3>
    </header>

    <form id="azure-form" class="w3-container w3-padding-16">
        <!-- Tenant ID - String -->
        <label>Tenant ID</label>
        <p class="w3-small w3-text-grey">Azure Tenant ID (used with Auth and Teams)</p>
        <input class="w3-input w3-border" type="text" name="tenant_id"
            value="{{ config['azure']['tenant-id'] if config['azure']['tenant-id'] is defined else '' }}" required>
    </form>

    <!-- Save button -->
    <button class="w3-button w3-green w3-block" name="azure_save" onclick="saveConfig('azure-form')">Save</button>
</div>
</br></br>


<!--
    ==========================================================================
    Authentication
    --------------------------------------------------------------------------
    app-id - The ID of the Azure application for authentication
    app-secret - The encrypted secret
    salt - The salt for the encrypted secret
    redirect-uri - The URL to redirect to after authentication
    admin-group - The Azure group ID for admin users
    ==========================================================================
-->
<div class="w3-responsive w3-card-4">
    <!-- Azure - Authentication -->
    <header class="w3-container w3-light-grey">
        <h3>Authentication</h3>
    </header>

    <form id="auth-form" class="w3-container w3-padding-16">
        <!-- App ID - String -->
        <label>App ID</label>
        <p class="w3-small w3-text-grey">App ID for authentication. May be different from the Teams app</p>
        <input class="w3-input w3-border w3-padding" type="text" name="auth_app_id"
            value="{{ config['authentication']['app-id'] if config['authentication']['app-id'] is defined else '' }}" required>
        <br>

        <!-- App Secret - The secret for the azure app - This gets encrypted -->
        <label>App Secret</label>
        <p class="w3-small w3-text-grey">Plaintext can be added here. This will be encrypted and will update the salt</p>
        <input class="w3-input w3-border" type="text" placeholder="App Secret" name="auth_app_secret"
            value="{{ config['authentication']['app-secret'] if config['authentication']['app-secret'] is defined else '' }}" required>
        <br>

        <!-- Salt - The salt for the encrypted secret -->
        <label>Salt</label>
        <p class="w3-small w3-text-grey">The salt that was generated when the password was encrypted</p>
        <input class="w3-input w3-border" type="text" name="auth_salt"
            value="{{ config['authentication']['salt'] if config['authentication']['salt'] is defined else '' }}">
        <br>

        <!-- Redirect URI - The URL to redirect to after authentication -->
        <label>Redirect URI</label>
        <p class="w3-small w3-text-grey">The callback URL that Azure calls during authentication</p>
        <input class="w3-input w3-border" type="text" name="auth_redirect_uri"
            value="{{ config['authentication']['redirect-uri'] if config['authentication']['redirect-uri'] is defined else '' }}" required>
        <br>

        <!-- Admin Group - The Azure group ID for admin users -->
        <label>Admin Group</label>
        <p class="w3-small w3-text-grey">The group in Azure that can access this app</p>
        <input class="w3-input w3-border" type="text" name="auth_admin_group"
            value="{{ config['authentication']['admin-group'] if config['authentication']['admin-group'] is defined else '' }}" required>
        <br>
    </form>

    <!-- Save button -->
    <button class="w3-button w3-green w3-block" name="auth_save" onclick="saveConfig('auth-form')">Save</button>
</div>
</br></br>


<!--
    ==========================================================================
    Teams
    --------------------------------------------------------------------------
    app-id - The ID of the Azure application for Teams
    app-secret - The encrypted secret
    salt - The salt for the encrypted secret
    base-url - The base URL for the Teams application
    user - The bot's user name
    user-id - The bot's user ID
    public-key - The public key file
    private-key - The private key file
    ==========================================================================
-->
<div class="w3-responsive w3-card-4">
    <!-- Azure - Teams -->
    <header class="w3-container w3-light-grey">
        <h3>Teams</h3>
    </header>

    <form id="teams-form" class="w3-container w3-padding-16">
        <!-- App ID -->
        <label>App ID</label>
        <p class="w3-small w3-text-grey">The ID for the Teams app. This may be different to the authentication app</p>
        <input class="w3-input w3-border w3-padding" type="text" name="teams_app_id"
            value="{{ config['teams']['app-id'] if config['teams']['app-id'] is defined else '' }}">
        <br>

        <!-- App Secret - The secret for the azure app - This gets encrypted -->
        <label>App Secret</label>
        <p class="w3-small w3-text-grey">Enter in plain text. This will be encrypted and the salt will be updated</p>
        <input class="w3-input w3-border" type="text" name="teams_app_secret"
            value="{{ config['teams']['app-secret'] if config['teams']['app-secret'] is defined else '' }}">
        <br>

        <!-- Salt - The salt for the encrypted secret -->
        <label>Salt</label>
        <p class="w3-small w3-text-grey">The salt for the encrypted password</p>
        <input class="w3-input w3-border" type="text" name="teams_salt"
            value="{{ config['teams']['salt'] if config['teams']['salt'] is defined else '' }}">
        <br>

        <!-- Base URL - The base URL for the API -->
        <label>Base URL</label>
        <p class="w3-small w3-text-grey">The base URL for the Graph API (Azure API)</p>
        <input class="w3-input w3-border" type="text" name="teams_base_url"
            value="{{ config['teams']['base-url'] if config['teams']['base-url'] is defined else '' }}">
        <br>

        <!-- User Name - The user name of the chat bot -->
        <label>User Name</label>
        <p class="w3-small w3-text-grey">The user name for the chatbot</p>
        <input class="w3-input w3-border" type="text" name="teams_user_name"
            value="{{ config['teams']['user'] if config['teams']['user'] is defined else '' }}">
        <br>

        <!-- User ID - The chat bot's ID in Azure -->
        <label>User ID</label>
        <p class="w3-small w3-text-grey">The chat bot's user ID in Azure</p>
        <input class="w3-input w3-border" type="text" name="teams_user_id"
            value="{{ config['teams']['user-id'] if config['teams']['user-id'] is defined else '' }}">
        <br>

        <!-- Public Key - Public Key file for chats -->
        <label>Public Key (file)</label>
        <p class="w3-small w3-text-grey">The filename for the public key. Used when sending/receiving messages</p>
        <input class="w3-input w3-border" type="text" name="teams_public_key"
            value="{{ config['teams']['public-key'] if config['teams']['public-key'] is defined else '' }}">
        <br>

        <!-- Private Key - Private Key file for chats -->
        <label>Private Key (file)</label>
        <p class="w3-small w3-text-grey">The filename for the private key. Corresponds to the public key</p>
        <input class="w3-input w3-border" type="text" name="teams_private_key"
            value="{{ config['teams']['private-key'] if config['teams']['private-key'] is defined else '' }}">
        <br>
    </form>

    <!-- Save button -->
    <button class="w3-button w3-green w3-block" name="teams_save" onclick="saveConfig('teams-form')">Save</button>
</div>
</br></br>



<!--
    ==========================================================================
    SQL
    --------------------------------------------------------------------------
    server - The SQL server name or IP
    port - The SQL server port
    database - The SQL database name
    user - The SQL user name
    password - The SQL user password
    salt - The salt for the encrypted password
    ==========================================================================
-->
<div class="w3-responsive w3-card-4">
    <!-- SQL -->
    <header class="w3-container w3-light-grey">
        <h3>SQL Database</h3>
    </header>

    <form id="sql-form" class="w3-container w3-padding-16">
        <!-- Server -->
        <label>Server</label>
        <p class="w3-small w3-text-grey">SQL server name</p>
        <input class="w3-input w3-border w3-padding" type="text" name="sql_server"
            value="{{ config['sql']['server'] if config['sql']['server'] is defined else '' }}">
        <br>

        <!-- Port -->
        <label>Port</label>
        <p class="w3-small w3-text-grey">SQL server port</p>
        <input class="w3-input w3-border w3-padding" type="text" name="sql_port"
            value="{{ config['sql']['port'] if config['sql']['port'] is defined else '' }}">
        <br>

        <!-- Database -->
        <label>Database</label>
        <p class="w3-small w3-text-grey">Database name</p>
        <input class="w3-input w3-border w3-padding" type="text" name="sql_database"
            value="{{ config['sql']['database'] if config['sql']['database'] is defined else '' }}">
        <br>

        <!-- Username (Service Account) -->
        <label>Username</label>
        <p class="w3-small w3-text-grey">Service Account that can access the database</p>
        <input class="w3-input w3-border w3-padding" type="text" name="sql_username"
            value="{{ config['sql']['username'] if config['sql']['username'] is defined else '' }}">
        <br>

        <!-- Password - This will be encrypted -->
        <label>Password</label>
        <p class="w3-small w3-text-grey">Enter in plain text. This will be encrypted and the salt will be updated</p>
        <input class="w3-input w3-border w3-padding" type="text" name="sql_password"
            value="{{ config['sql']['password'] if config['sql']['password'] is defined else '' }}">
        <br>

        <!-- Salt - Goes with encrypted password -->
        <label>Salt</label>
        <p class="w3-small w3-text-grey">The salt corresponding to the encrypted password</p>
        <input class="w3-input w3-border w3-padding" type="text" name="sql_salt"
            value="{{ config['sql']['salt'] if config['sql']['salt'] is defined else '' }}">
        <br>
    </form>

    <!-- Save button -->
    <button class="w3-button w3-green w3-block" name="sql_save" onclick="saveConfig('sql-form')">Save</button>
</div>
</br></br>


<!--
    ==========================================================================
    Web
    --------------------------------------------------------------------------
    Debug - Enable or disable flask debug mode
    ==========================================================================
-->
<div class="w3-responsive w3-card-4">
    <!-- Web interface settings  -->
    <header class="w3-container w3-light-grey">
        <h3>Web Interface</h3>
    </header>

    <form id="web-form" class="w3-container w3-padding-16">
        <!-- Debug mode - True or False -->
        <label>Debug Mode</label>
        <p class="w3-small w3-text-grey">Enables additional terminal messages</p>
        <input class="w3-check" type="checkbox" name="web_debug"
            {% if config['web']['debug'] %}checked{% endif %}>
    </form>

    <!-- Save button -->
    <button class="w3-button w3-green w3-block" name="web_save" onclick="saveConfig('web-form')">Save</button>
</div>
</br></br>
{% endblock %}